# Kiro ä¼ä¸šè´¦æˆ·ä½¿ç”¨æŒ‡å—

## ğŸ¢ ä¼ä¸š IAM Identity Center è®¤è¯

### å‰ææ¡ä»¶
- ä¼ä¸šæä¾›çš„ IAM Identity Center Start URL
- çŸ¥é“éƒ¨ç½²çš„ AWS åŒºåŸŸï¼ˆå¦‚ us-east-1, ap-southeast-1 ç­‰ï¼‰

### è®¤è¯æ­¥éª¤

#### 1. å¯åŠ¨è®¤è¯æµç¨‹

```bash
python main.py auth kiro --method aws \
  --aws-start-url https://your-company.awsapps.com/start \
  --aws-region ap-southeast-1
```

**å‚æ•°è¯´æ˜**:
- `--aws-start-url`: ä¼ä¸šçš„ IAM Identity Center ç™»å½• URL
- `--aws-region`: ä¼ä¸š Identity Center éƒ¨ç½²çš„åŒºåŸŸï¼ˆé‡è¦ï¼ï¼‰

#### 2. å®Œæˆè®¾å¤‡æˆæƒ

å‘½ä»¤ä¼šæ˜¾ç¤ºç±»ä¼¼è¾“å‡ºï¼š

```
============================================================
Kiro AWS Builder ID / IAM Identity Center è®¤è¯
============================================================
Start URL: https://your-company.awsapps.com/start
Region: ap-southeast-1

æ­£åœ¨æ³¨å†Œè®¾å¤‡...
æ³¨å†ŒæˆåŠŸ:
  clientId: HWWWmgd-IJ5Jn-uCwtUuM3Vz...
  scopes: ['codewhisperer:completions', 'codewhisperer:analysis', 'sso:account:access']

æ­£åœ¨è·å–è®¾å¤‡ç ...

ç”¨æˆ·ç : ABCD-EFGH

è¯·åœ¨ä»»æ„è®¾å¤‡çš„æµè§ˆå™¨ä¸­è®¿é—®:
https://device.sso.ap-southeast-1.amazonaws.com/...

============================================================
ç­‰å¾…è®¤è¯å®Œæˆ...
```

#### 3. åœ¨æµè§ˆå™¨ä¸­å®Œæˆæˆæƒ

1. è®¿é—®æ˜¾ç¤ºçš„ URL
2. è¾“å…¥ç”¨æˆ·ç  (å¦‚ `ABCD-EFGH`)
3. ä½¿ç”¨ä¼ä¸šè´¦æˆ·ç™»å½•
4. æˆæƒè®¿é—®æƒé™

#### 4. è®¤è¯å®Œæˆ

```
âœ“ è·å–åˆ° profileArn: arn:aws:codewhisperer:...
è®¤è¯æˆåŠŸ!
```

---

## ğŸ”„ ä»¤ç‰Œç®¡ç†

### åˆ·æ–°ä»¤ç‰Œ

```bash
# åˆ·æ–°æ‰€æœ‰è¿‡æœŸæˆ–å³å°†è¿‡æœŸçš„ä»¤ç‰Œ
python main.py token refresh

# æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
python main.py token refresh --verbose
```

**è‡ªåŠ¨åˆ·æ–°æœºåˆ¶**:
- ä»¤ç‰Œåˆ°æœŸå‰ **5 åˆ†é’Ÿ** è‡ªåŠ¨åˆ·æ–°
- ä½¿ç”¨æ­£ç¡®çš„åŒºåŸŸç«¯ç‚¹ï¼ˆä»è®¤è¯æ–‡ä»¶è¯»å–ï¼‰
- è‡ªåŠ¨ä¿å­˜æ›´æ–°åçš„ä»¤ç‰Œ

**ç¤ºä¾‹è¾“å‡º**:

```
å¼€å§‹åˆ·æ–°ä»¤ç‰Œ...
============================================================
[aws-builder-id] 239 ç§’åè¿‡æœŸ (< 5 åˆ†é’Ÿç¼“å†²)
âœ“ å·²åˆ·æ–°ä»¤ç‰Œ: aws-builder-id
============================================================

âœ“ å·²åˆ·æ–° 1 ä¸ªä»¤ç‰Œ
```

---

## ğŸ”§ å‡­è¯è‡ªåŠ¨è¡¥å…¨

å¦‚æœä½ å·²ç»ä½¿ç”¨ AWS CLI æˆ– AWS IDE ç™»å½•è¿‡ä¼ä¸šè´¦æˆ·ï¼ŒPython CLI ä¼šè‡ªåŠ¨ä» `~/.aws/sso/cache/` åŠ è½½å‡­è¯ã€‚

**å·¥ä½œåŸç†**:
1. æ£€æµ‹è®¤è¯æ–‡ä»¶ç¼ºå°‘ `client_id` æˆ– `client_secret`
2. æ‰«æ `~/.aws/sso/cache/` ç›®å½•
3. è‡ªåŠ¨è¡¥å…¨ç¼ºå¤±çš„å‡­è¯
4. ä¿å­˜åˆ°è®¤è¯æ–‡ä»¶

**æ— éœ€æ‰‹åŠ¨æ“ä½œ**ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ã€‚

---

## ğŸ” æ•…éšœæ’æŸ¥

### ProfileARN è·å–å¤±è´¥

å¦‚æœçœ‹åˆ°ï¼š

```
âš ï¸  æœªè¿”å› profilesï¼ˆå¯èƒ½æ˜¯ä¼ä¸šè´¦æˆ·æƒé™é™åˆ¶ï¼‰
â„¹ï¸  ProfileARN ç¼ºå¤±ä¸å½±å“é¢åº¦æŸ¥è¯¢åŠŸèƒ½
```

**è¿™æ˜¯æ­£å¸¸çš„**ã€‚æŸäº›ä¼ä¸šè´¦æˆ·ç”±äºæƒé™é™åˆ¶æ— æ³•è®¿é—® `listProfiles` APIã€‚ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼ˆé¢åº¦æŸ¥è¯¢ï¼‰ã€‚

---

### ä»¤ç‰Œåˆ·æ–°å¤±è´¥

å¦‚æœä»¤ç‰Œåˆ·æ–°å¤±è´¥ï¼Œæ£€æŸ¥ï¼š

1. **åŒºåŸŸæ˜¯å¦æ­£ç¡®**
   ```bash
   cat ~/.cli-proxy-api/kiro-aws-builder-id.json | grep region
   ```

   åº”è¯¥æ˜¾ç¤ºä¼ä¸š Identity Center çš„å®é™…éƒ¨ç½²åŒºåŸŸã€‚

2. **å‡­è¯æ˜¯å¦å®Œæ•´**
   ```bash
   cat ~/.cli-proxy-api/kiro-aws-builder-id.json | jq '{client_id, client_secret, region}'
   ```

   åº”è¯¥åŒ…å« `client_id`, `client_secret`, å’Œ `region`ã€‚

3. **æ‰‹åŠ¨åˆ·æ–°æµ‹è¯•**
   ```bash
   python main.py token refresh --verbose
   ```

---

### ä¸åŒåŒºåŸŸçš„å¸¸è§é…ç½®

| åœ°åŒº | åŒºåŸŸä»£ç  | ç¤ºä¾‹ Start URL |
|------|---------|---------------|
| ç¾å›½ä¸œéƒ¨ | us-east-1 | https://xxx.awsapps.com/start |
| äºšå¤ªï¼ˆæ–°åŠ å¡ï¼‰| ap-southeast-1 | https://xxx.awsapps.com/start |
| äºšå¤ªï¼ˆä¸œäº¬ï¼‰| ap-northeast-1 | https://xxx.awsapps.com/start |
| æ¬§æ´²ï¼ˆæ³•å…°å…‹ç¦ï¼‰| eu-central-1 | https://xxx.awsapps.com/start |
| æ¬§æ´²ï¼ˆçˆ±å°”å…°ï¼‰| eu-west-1 | https://xxx.awsapps.com/start |

**é‡è¦**: Start URL å¯èƒ½çœ‹èµ·æ¥ç›¸åŒï¼Œä½†å®é™…éƒ¨ç½²åŒºåŸŸä¸åŒã€‚è¯·å‘ IT ç®¡ç†å‘˜ç¡®è®¤æ­£ç¡®çš„åŒºåŸŸã€‚

---

## ğŸ“Š æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯

```bash
# åˆ—å‡ºæ‰€æœ‰å·²è®¤è¯è´¦æˆ·
python main.py accounts list
```

---

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **è®¤è¯æ–‡ä»¶ä½ç½®**: `~/.cli-proxy-api/`
2. **æ–‡ä»¶æƒé™**: å»ºè®®è®¾ç½®ä¸º 600 (ä»…æ‰€æœ‰è€…å¯è¯»å†™)
   ```bash
   chmod 600 ~/.cli-proxy-api/*.json
   ```
3. **å‡­è¯è½®æ¢**: å®šæœŸé‡æ–°è®¤è¯ä»¥ä¿æŒå®‰å…¨æ€§
4. **ä¸è¦å…±äº«**: è®¤è¯æ–‡ä»¶åŒ…å«æ•æ„Ÿå‡­è¯ï¼Œä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

---

## ğŸ†˜ è·å–å¸®åŠ©

```bash
# æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤
python main.py --help

# æŸ¥çœ‹è®¤è¯å‘½ä»¤å¸®åŠ©
python main.py auth --help

# æŸ¥çœ‹ä»¤ç‰Œç®¡ç†å¸®åŠ©
python main.py token --help
```

---

## ğŸ“ è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. è¿è¡Œè¯Šæ–­å·¥å…·ï¼š
   ```bash
   python diagnose_kiro.py
   ```

2. æŸ¥çœ‹ä¿®å¤æ€»ç»“ï¼š
   ```bash
   cat FIXES_SUMMARY.md
   ```

3. æ£€æŸ¥è®¤è¯æ–‡ä»¶ï¼š
   ```bash
   cat ~/.cli-proxy-api/kiro-aws-builder-id.json | jq '.'
   ```
